<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gierki by Kamil üß¨</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #080b14;
            --card: rgba(30, 41, 59, 0.7);
            --accent: #38bdf8;
            --text: #f1f5f9;
            --success: #10b981;
            --danger: #f43f5e;
            --xp: #fbbf24;
        }

        * {
            box-sizing: border-box;
        }
        /* Kluczowa poprawka ramek */
        body {
            background: radial-gradient(circle at top right, #1e1b4b, #080b14);
            font-family: 'Outfit', sans-serif;
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
        }

        .card {
            background: var(--card);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 32px;
            border: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            width: 100%;
        }

        .hidden {
            display: none !important;
        }

        h1 {
            font-size: 3.5rem;
            margin: 0;
            font-weight: 800;
        }

        .subtitle {
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.8rem;
            margin-bottom: 30px;
        }

        input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            background: #0f172a;
            color: white;
            outline: none;
        }

        button.action-btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: none;
            font-weight: bold;
            background: var(--accent);
            color: #080b14;
            cursor: pointer;
            margin-top: 10px;
        }

        .main-btn {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 24px;
            margin-bottom: 15px;
            cursor: pointer;
            width: 100%;
            color: white;
            text-align: left;
            display: block;
        }

        .mode-select {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .mode-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid var(--accent);
            background: none;
            color: white;
            cursor: pointer;
            font-size: 0.7rem;
        }

            .mode-btn.active {
                background: var(--accent);
                color: #080b14;
            }

        .hint-toggle {
            margin: 15px 0;
            padding: 10px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 0.8rem;
        }

        #test-action-banner {
            padding: 12px;
            border-radius: 14px;
            margin-bottom: 20px;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.7rem;
        }

        .status-asking {
            background: rgba(56, 189, 248, 0.15);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        .status-guessing {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .xp-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: var(--xp);
            transition: width 0.5s;
        }

        .reveal-item {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 15px;
            margin-top: 8px;
            text-align: left;
            border-left: 4px solid #444;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="screen-launcher">
            <center><h1>Gierki</h1><p class="subtitle">by Kamil</p></center>
            <button class="main-btn" onclick="nav('screen-impostor-auth')"><h2>üïµÔ∏è‚Äç‚ôÇÔ∏è Impostor</h2><p>Znajd≈∫ zdrajcƒô. Has≈Ça lub pytania.</p></button>
            <button class="main-btn" onclick="handleTestAutoLogin()"><h2>üß¨ The Test</h2><p>Sprawd≈∫ dopasowanie w relacji.</p></button>
        </div>

        <div id="screen-impostor-auth" class="card hidden">
            <h2>Impostor</h2>
            <input type="text" id="imp-nick" placeholder="Tw√≥j Nick">
            <input type="text" id="imp-room" placeholder="Kod pokoju">
            <div class="mode-select">
                <button class="mode-btn active" id="btn-m-w" onclick="setImpMode('words')">HAS≈ÅA</button>
                <button class="mode-btn" id="btn-m-q" onclick="setImpMode('questions')">PYTANIA</button>
            </div>
            <div id="hint-option-box" class="hint-toggle" onclick="toggleHints()">
                <span>Podpowiedzi (Tryb Hase≈Ç)</span>
                <span id="hint-status" style="color:var(--danger); font-weight:800;">OFF</span>
            </div>
            <button class="action-btn" onclick="startImpostor(true)">STW√ìRZ POK√ìJ</button>
            <button class="action-btn" style="background:#334155; color:white;" onclick="startImpostor(false)">DO≈ÅƒÑCZ</button>
            <p onclick="nav('screen-launcher')" style="cursor:pointer; opacity:0.6; margin-top:20px;">‚Üê Powr√≥t</p>
        </div>

        <div id="screen-impostor-game" class="card hidden">
            <h3 id="imp-display-room">Pok√≥j: -</h3>
            <div id="imp-waiting">
                <p>Gracze w pokoju:</p>
                <div id="imp-players" style="margin: 20px 0;"></div>
                <button class="action-btn" id="imp-start-btn" onclick="revealRoles()" style="display:none">START GRY</button>
            </div>
            <div id="imp-role-card" class="hidden">
                <h2 id="role-title">Twoja rola</h2>
                <div id="role-value" style="font-size: 1.5rem; color: var(--accent); margin: 25px 0; font-weight: 800; border: 2px dashed var(--accent); padding: 15px; border-radius: 15px;"></div>
                <p id="role-desc" style="font-size: 0.9rem; opacity: 0.8;"></p>
            </div>
            <button class="action-btn" style="background:#551a1a; color:white; margin-top:40px;" onclick="leaveImpostor()">Wyjd≈∫</button>
        </div>

        <div id="screen-test-auth" class="card hidden"><h2>The Test</h2><input type="text" id="test-nick" placeholder="Nick"><input type="password" id="test-pin" placeholder="PIN"><button class="action-btn" onclick="testLogin()">ZALOGUJ</button></div>
        <div id="screen-test-dash" class="card hidden"><div style="display:flex; justify-content:space-between;"><h3 id="test-user-name"></h3><span onclick="nav('screen-launcher')" style="color:var(--accent); cursor:pointer">MENU</span></div><div id="test-list"></div><input type="text" id="test-target" placeholder="Nick partnera"><button class="action-btn" onclick="newTestRel()">+ RELACJA</button></div>
        <div id="screen-test-play" class="card hidden"><div id="test-lvl" class="subtitle"></div><div class="xp-bar"><div id="test-xp-f" class="xp-fill"></div></div><div id="test-dots" style="display:flex; justify-content:center; gap:5px; margin:15px 0;"></div><div id="test-action-banner"></div><h2 id="test-q"></h2><div id="test-options"></div><div id="test-history" class="hidden"><div id="test-hist-list"></div></div></div>
        <div id="screen-test-reveal" class="card hidden"><h2>Wyniki!</h2><div id="test-rev-list"></div><button class="action-btn" onclick="testConfirmReveal()">DALEJ</button></div>
    </div>

    <script>
        // ==========================================
        // üü¢ DANE: IMPOSTOR (HAS≈ÅA)
        // ==========================================
        const WORDS_DATABASE = [
            { haslo: "Woda", podpowiedzi: ["≈ªycie", "Przezroczysto≈õƒá", "Niezbƒôdne"] },
            { haslo: "S≈Ço≈Ñce", podpowiedzi: ["Jasno≈õƒá", "G√≥ra", "Energia"] },
            { haslo: "Ksiƒô≈ºyc", podpowiedzi: ["Cykl", "Noc", "Srebro"] },
            { haslo: "Deszcz", podpowiedzi: ["Chmury", "Spadanie", "Mokro"] },
            { haslo: "≈önieg", podpowiedzi: ["Biel", "Zimno", "Puch"] },
            { haslo: "Ogie≈Ñ", podpowiedzi: ["Ciep≈Ço", "Niszczenie", "Czerwony"] },
            { haslo: "Wiatr", podpowiedzi: ["Ruch", "Niewidzialne", "Ch≈Ç√≥d"] },
            { haslo: "Pies", podpowiedzi: ["Wierno≈õƒá", "Domowe", "Opieka"] },
            { haslo: "Kot", podpowiedzi: ["Niezale≈ºno≈õƒá", "Domowe", "Miƒôkko≈õƒá"] },
            { haslo: "Ptak", podpowiedzi: ["Wolno≈õƒá", "Pi√≥ra", "Wysoko≈õƒá"] },
            { haslo: "Drzewo", podpowiedzi: ["Korze≈Ñ", "Ziele≈Ñ", "Drewno"] },
            { haslo: "Kwiat", podpowiedzi: ["Zapach", "Kolor", "Prezent"] },
            { haslo: "Trawa", podpowiedzi: ["Pod≈Ço≈ºe", "Ziele≈Ñ", "Ogr√≥d"] },
            { haslo: "Chleb", podpowiedzi: ["Codzienno≈õƒá", "MƒÖka", "Pieczone"] },
            { haslo: "Mas≈Ço", podpowiedzi: ["T≈Çuszcz", "Smarowanie", "Lod√≥wka"] },
            { haslo: "Ser", podpowiedzi: ["Mleko", "Dziury", "Dodatek"] },
            { haslo: "Czekolada", podpowiedzi: ["S≈Çodycz", "Kostka", "BrƒÖz"] },
            { haslo: "S√≥l", podpowiedzi: ["Smak", "Bia≈Çe", "Kryszta≈Ç"] },
            { haslo: "Cukier", podpowiedzi: ["S≈Çodycz", "Energia", "Bia≈Çe"] },
            { haslo: "Jajko", podpowiedzi: ["PoczƒÖtek", "Krucho≈õƒá", "Bia≈Çko"] },
            { haslo: "Mleko", podpowiedzi: ["Biel", "P≈Çyn", "Zdrowie"] },
            { haslo: "Sok", podpowiedzi: ["Owoce", "P≈Çyn", "Szklanka"] },
            { haslo: "Zupa", podpowiedzi: ["Ciep≈Ço", "Talerz", "Mieszanie"] },
            { haslo: "Miƒôso", podpowiedzi: ["Bia≈Çko", "Si≈Ça", "Jedzenie"] },
            { haslo: "Ryba", podpowiedzi: ["Woda", "≈Åuska", "P≈Çywanie"] },
            { haslo: "Owoc", podpowiedzi: ["S≈Çodycz", "Drzewo", "Witaminy"] },
            { haslo: "Warzywo", podpowiedzi: ["Zdrowie", "Ziemia", "Kolor"] },
            { haslo: "Szko≈Ça", podpowiedzi: ["Nauka", "Budynek", "Wiedza"] },
            { haslo: "Praca", podpowiedzi: ["Zarobek", "ObowiƒÖzek", "Czas"] },
            { haslo: "PieniƒÖdze", podpowiedzi: ["Warto≈õƒá", "Metal", "Papier"] },
            { haslo: "Portfel", podpowiedzi: ["Zasoby", "Kiesze≈Ñ", "Sk√≥ra"] },
            { haslo: "Torba", podpowiedzi: ["Przechowywanie", "Uchwyt", "Ciƒô≈ºar"] },
            { haslo: "Buty", podpowiedzi: ["Pod≈Ço≈ºe", "Para", "Krok"] },
            { haslo: "Koszulka", podpowiedzi: ["Bawe≈Çna", "Cia≈Ço", "Kolor"] },
            { haslo: "Spodnie", podpowiedzi: ["Nogi", "Kiesze≈Ñ", "Materia≈Ç"] },
            { haslo: "Kurtka", podpowiedzi: ["Zimno", "ZewnƒÖtrz", "Zamek"] },
            { haslo: "Czapka", podpowiedzi: ["G≈Çowa", "Ciep≈Ço", "G√≥ra"] },
            { haslo: "Zegar", podpowiedzi: ["Rytm", "Pomiar", "Wskaz√≥wka"] },
            { haslo: "≈Å√≥≈ºko", podpowiedzi: ["Poziom", "Odpoczynek", "Miƒôkko"] },
            { haslo: "St√≥≈Ç", podpowiedzi: ["P≈Çaszczyzna", "Nogi", "Spotkanie"] },
            { haslo: "Krzes≈Ço", podpowiedzi: ["Odpoczynek", "Nogi", "Siedzenie"] },
            { haslo: "Okno", podpowiedzi: ["Widok", "Szyba", "≈öwiat≈Ço"] },
            { haslo: "Drzwi", podpowiedzi: ["Przej≈õcie", "Bariera", "Uchwyt"] },
            { haslo: "Lampa", podpowiedzi: ["≈öwiat≈Ço", "Jasno≈õƒá", "PrƒÖd"] },
            { haslo: "Komputer", podpowiedzi: ["Ekran", "Praca", "Narzƒôdzie"] },
            { haslo: "Internet", podpowiedzi: ["Sieƒá", "Informacja", "Po≈ÇƒÖczenie"] },
            { haslo: "KsiƒÖ≈ºka", podpowiedzi: ["Wiedza", "Papier", "Strona"] },
            { haslo: "Gazeta", podpowiedzi: ["Informacja", "Dzie≈Ñ", "Papier"] },
            { haslo: "Film", podpowiedzi: ["Obraz", "Historia", "Ekran"] },
            { haslo: "Muzyka", podpowiedzi: ["D≈∫wiƒôk", "Rytm", "Emocje"] },
            { haslo: "Radio", podpowiedzi: ["D≈∫wiƒôk", "Fala", "G≈Ços"] },
            { haslo: "Telefon", podpowiedzi: ["Kontakt", "Kiesze≈Ñ", "Ekran"] },
            { haslo: "Aparat", podpowiedzi: ["PamiƒÖtka", "Obraz", "Chwila"] },
            { haslo: "Samoch√≥d", podpowiedzi: ["Ruch", "Szybko≈õƒá", "Cel"] },
            { haslo: "Autobus", podpowiedzi: ["Ludzie", "Ruch", "Przystanek"] },
            { haslo: "PociƒÖg", podpowiedzi: ["Tor", "Ruch", "Dworzec"] },
            { haslo: "Rower", podpowiedzi: ["Ko≈Ça", "Si≈Ça", "Ruch"] },
            { haslo: "Samolot", podpowiedzi: ["Wysoko≈õƒá", "Podr√≥≈º", "Powietrze"] },
            { haslo: "Statek", podpowiedzi: ["Woda", "Fala", "Podr√≥≈º"] },
            { haslo: "Miasto", podpowiedzi: ["Budynki", "T≈Çum", "Ha≈Ças"] },
            { haslo: "Wie≈õ", podpowiedzi: ["Cisza", "Natura", "Przestrze≈Ñ"] },
            { haslo: "Dom", podpowiedzi: ["Bezpiecze≈Ñstwo", "Rodzina", "≈öciany"] },
            { haslo: "Mieszkanie", podpowiedzi: ["SƒÖsiedzi", "Piƒôtro", "Blok"] },
            { haslo: "Las", podpowiedzi: ["Drzewa", "Ziele≈Ñ", "Cisza"] },
            { haslo: "Pla≈ºa", podpowiedzi: ["Piasek", "Woda", "Lato"] },
            { haslo: "Park", podpowiedzi: ["Odpoczynek", "≈Åawka", "Spacer"] },
            { haslo: "Sklep", podpowiedzi: ["Wymiana", "P√≥≈Çka", "Zakupy"] },
            { haslo: "Apteka", podpowiedzi: ["Pomoc", "Biel", "Zdrowie"] },
            { haslo: "Kino", podpowiedzi: ["Sala", "Ekran", "Ciemno≈õƒá"] },
            { haslo: "Teatr", podpowiedzi: ["Scena", "Sztuka", "Aktor"] },
            { haslo: "≈Å√≥≈ºko", podpowiedzi: ["Odpoczynek", "Poziom", "Miƒôkko"] },
            { haslo: "Telefon", podpowiedzi: ["Kontakt", "Ekran", "Blisko≈õƒá"] },
            { haslo: "Telewizor", podpowiedzi: ["Salon", "Obraz", "Przekaz"] },
            { haslo: "Prysznic", podpowiedzi: ["Woda", "Start", "Od≈õwie≈ºenie"] },
            { haslo: "Lod√≥wka", podpowiedzi: ["Zas√≥b", "Ch≈Ç√≥d", "Kuchnia"] },
            { haslo: "Samoch√≥d", podpowiedzi: ["Ruch", "Metal", "Kierunek"] },
            { haslo: "Zegarek", podpowiedzi: ["Czas", "Nadgarstek", "Ruch"] },
            { haslo: "Klucze", podpowiedzi: ["Dostƒôp", "Metal", "D≈∫wiƒôk"] },
            { haslo: "PieniƒÖdze", podpowiedzi: ["Wymiana", "Warto≈õƒá", "Papier"] },
            { haslo: "Plecak", podpowiedzi: ["Ciƒô≈ºar", "Wyj≈õcie", "Pamiƒôƒá"] },
            { haslo: "Pralka", podpowiedzi: ["Wirowanie", "Zapach", "Ubranie"] },
            { haslo: "Lustro", podpowiedzi: ["Odbicie", "Szk≈Ço", "Prawda"] },
            { haslo: "Drzwi", podpowiedzi: ["Przej≈õcie", "Bariera", "Klamka"] },
            { haslo: "Zapalniczka", podpowiedzi: ["Ogie≈Ñ", "Kiesze≈Ñ", "Klik"] },
            { haslo: "S≈Çuchawki", podpowiedzi: ["D≈∫wiƒôk", "Izolacja", "Uszy"] },
            { haslo: "Si≈Çownia", podpowiedzi: ["Ruch", "Wysi≈Çek", "Miejsce"] },
            { haslo: "Kino", podpowiedzi: ["Ekran", "Ciemno≈õƒá", "D≈∫wiƒôk"] },
            { haslo: "Basen", podpowiedzi: ["Ruch", "Wilgoƒá", "Sport"] },
            { haslo: "G√≥ry", podpowiedzi: ["Wysoko≈õƒá", "Natura", "Widok"] },
            { haslo: "Morze", podpowiedzi: ["Horyzont", "S√≥l", "Piasek"] },
            { haslo: "Rower", podpowiedzi: ["Ko≈Ça", "Droga", "Napƒôd"] },
            { haslo: "Las", podpowiedzi: ["Ziele≈Ñ", "Cisza", "Powietrze"] },
            { haslo: "TikTok", podpowiedzi: ["Scroll", "D≈∫wiƒôk", "Szybko"] },
            { haslo: "YouTube", podpowiedzi: ["Wideo", "Wiedza", "Czas"] },
            { haslo: "Minecraft", podpowiedzi: ["Klocki", "≈öwiat", "Praca"] },
            { haslo: "Szachy", podpowiedzi: ["G≈Çowa", "Ruch", "Plan"] },
            { haslo: "Klub", podpowiedzi: ["Noc", "Ludzie", "Rytm"] },
            { haslo: "Narty", podpowiedzi: ["Puch", "Zjazd", "Zima"] },
            { haslo: "Koncert", podpowiedzi: ["G≈Ço≈õno", "Scena", "Emocje"] },
            { haslo: "Krƒôgle", podpowiedzi: ["Ciƒô≈ºar", "Precyzja", "Tor"] },
            { haslo: "Kebab", podpowiedzi: ["Miasto", "Szybko", "Ciep≈Ço"] },
            { haslo: "Sushi", podpowiedzi: ["Zimno", "Kszta≈Çt", "Estetyka"] },
            { haslo: "Burger", podpowiedzi: ["Warstwy", "Rƒôce", "Klasyk"] },
            { haslo: "Frytki", podpowiedzi: ["Ziemia", "S√≥l", "Z≈Çoto"] },
            { haslo: "Pizza", podpowiedzi: ["Dzielenie", "Tr√≥jkƒÖt", "Wiecz√≥r"] },
            { haslo: "Lody", podpowiedzi: ["Temperatura", "S≈Çodycz", "Lato"] },
            { haslo: "Piwo", podpowiedzi: ["Spotkanie", "Gorycz", "Szk≈Ço"] },
            { haslo: "Kawa", podpowiedzi: ["Poranek", "Rytua≈Ç", "Energia"] },
            { haslo: "PƒÖczek", podpowiedzi: ["T≈Çuszcz", "Ko≈Ço", "Tradycja"] },
            { haslo: "Ros√≥≈Ç", podpowiedzi: ["Dom", "Zupa", "Niedziela"] },
            { haslo: "Zapiekanka", podpowiedzi: ["Chrupko≈õƒá", "D≈Çugo≈õƒá", "Ulica"] },
            { haslo: "Popcorn", podpowiedzi: ["D≈∫wiƒôk", "Oczekiwanie", "Lekko≈õƒá"] },
            { haslo: "Hot Dog", podpowiedzi: ["Stacja", "Prostota", "PrzekƒÖska"] },
            { haslo: "Pierogi", podpowiedzi: ["Wnƒôtrze", "MƒÖka", "Woda"] },
            { haslo: "Herbata", podpowiedzi: ["Li≈õcie", "Kubek", "Ciep≈Ço"] }
        ];

        // ==========================================
        // üïµÔ∏è‚Äç‚ôÇÔ∏è DANE: IMPOSTOR (PYTANIA)
        // { haslo: "Pytanie dla grupy", qImp: "Pytanie dla Impostora" }
        // ==========================================
        const QUES_DATABASE = [
            { haslo: "Jaki jest tw√≥j ulubiony kolor?", qImp: "Jakiego koloru ≈õcian nie chcia≈Ç by≈õ mieƒá w pokoju?" },
            { haslo: "Kt√≥ry z gracz najszybciej poszed≈Ç by do pierdla?", qImp: "Kt√≥ry z graczy najbardziej unika problem√≥w" },
            { haslo: "Jakie jest twoje ulubione danie?", qImp: "Jakiego dania nie chcia≈Ç by≈õ je≈õƒá do ko≈Ñca ≈ºycia" },
            { haslo: "Kt√≥ry z graczy jest najmƒÖdrzejszy", qImp: "Kt√≥ry z graczy jest najbardziej wygadany" },
            { haslo: "Co lubisz robiƒá w wolnym czasie", qImp: "Czego nie lubisz robisz a wiƒôkszo≈õƒá lubi" },
            { haslo: "Najwiƒôkszy red flag u p≈Çci przeciwnej", qImp: "Co cie najbardziej jara w p≈Çci przeciwnej" },
            { haslo: "Jaki jest tw√≥j ulubiony sport", qImp: "Kt√≥rego sportu najbardziej nie rozumiesz" },
            { haslo: "Kt√≥ry z graczy jest najbardziej odpowiedzialny", qImp: "Kt√≥remu z graczy nie da≈Ç by≈õ w opiekƒô dziecka" },
            { haslo: "Kt√≥ry z graczy najszybciej zosta≈Çby milionerem?", qImp: "Kt√≥ry z graczy najszybciej wyda≈Çby ca≈ÇƒÖ wyp≈Çatƒô w jeden dzie≈Ñ?" },
            { haslo: "Twoje wymarzone miejsce na wakacje?", qImp: "Miejsce, w kt√≥rym za darmo by≈õ nie zamieszka≈Ç(a)?" },
            { haslo: "Kt√≥ry z graczy jest najwiƒôkszym flirciarzem?", qImp: "Kt√≥ry z graczy jest najbardziej nie≈õmia≈Çy w nowym towarzystwie?" },
            { haslo: "Z kt√≥rym graczem chcia≈Çby≈õ utknƒÖƒá na bezludnej wyspie?", qImp: "Z kt√≥rym graczem najtrudniej by≈Çoby ci siƒô dogadaƒá w stresujƒÖcej sytuacji?" },
            { haslo: "Co robisz najpierw po przebudzeniu?", qImp: "Czego  absolutnie nie cierpisz robiƒá rano?" },
            { haslo: "Kt√≥ry z graczy ma najdziwniejsze hobby?", qImp: "Kt√≥ry z graczy jest najbardziej przewidywalny i spokojny?" },
            { haslo: "Jaki by≈Ç tw√≥j ulubiony przedmiot w szkole?", qImp: "Z kt√≥rego przedmiotu w szkole mia≈Çe≈õ najgorsze oceny?" },
            { haslo: "Kt√≥ry z graczy najlepiej gotuje?", qImp: "Po czyim gotowaniu najbardziej ba≈Çby≈õ siƒô o sw√≥j ≈ºo≈ÇƒÖdek?" },
            { haslo: "Jaka cecha charakteru jest najlepsza?", qImp: "Jaka cecha charakteru bywa najbardziej irytujƒÖca?" },
            { haslo: "W jakim zawodzie najlepiej odnalaz≈Çby≈õ siƒô?", qImp: "W jakiej pracy  kompletnie bys sobie nie poradzi≈Ç(a)?" },
            { haslo: "Jaki nap√≥j najczƒô≈õciej pijesz do obiadu?", qImp: "Co zazwyczaj zamawiasz, gdy jeste≈õ w kawiarni?" },
            { haslo: "O kt√≥rej godzinie zazwyczaj k≈Çadziesz siƒô spaƒá?", qImp: "O kt√≥rej godzinie ko≈Ñczy siƒô dla Ciebie wiecz√≥r?" },
            { haslo: "W jakim sklepie najczƒô≈õciej zostawiasz pieniƒÖdze?", qImp: "Gdzie zazwyczaj kupujesz ubrania?" },
            { haslo: "Co zazwyczaj jesz na ≈õniadanie?", qImp: "Co najchƒôtniej zjad≈Çby≈õ na szybko w ciƒÖgu dnia?" },
            { haslo: "Bez jakiego gad≈ºetu nie wychodzisz z domu?", qImp: "Co masz zawsze pod rƒôkƒÖ, gdy siedzisz przy biurku?" },
            { haslo: "Ile czasu dziennie spƒôdzasz na telefonie?", qImp: "Ile czasu zajmuje Ci ranna rutyna w ≈Çazience?" },
            { haslo: "Jaki jest Tw√≥j ulubiony owoc?", qImp: "Z jakiego owocu sok wybierasz najczƒô≈õciej?" },
            { haslo: "Jaki kolor dominuje w Twojej szafie?", qImp: "Jaki kolor najbardziej pasuje do Twojej osobowo≈õci?" },
            { haslo: "Czym najczƒô≈õciej doje≈ºd≈ºasz do szko≈Çy/pracy?", qImp: "Jaki jest wed≈Çug Ciebie najwygodniejszy ≈õrodek transportu?" },
            { haslo: "Jaki gatunek filmowy lubisz najbardziej?", qImp: "Jaki typ seriali najczƒô≈õciej wybierasz na wiecz√≥r?" },
            { haslo: "Gdzie najchƒôtniej chodzisz na spacer?", qImp: "W jakim otoczeniu czujesz siƒô najbardziej zrelaksowany?" },
            { haslo: "Jaki sport lubi≈Çe≈õ uprawiaƒá w dzieci≈Ñstwie?", qImp: "OglƒÖdanie jakiej dyscypliny sportowej sprawia Ci frajdƒô?" },
            { haslo: "Jaki jest Tw√≥j ulubiony dzie≈Ñ tygodnia?", qImp: "Kt√≥ry dzie≈Ñ tygodnia jest dla Ciebie najbardziej produktywny?" },
            { haslo: "W jakim jƒôzyku chcia≈Çby≈õ umieƒá m√≥wiƒá p≈Çynnie?", qImp: "Jaki jƒôzyk jest dla ciebie najbardziej dziwny" },
            { haslo: "Jaka jest Twoja ulubiona pora roku?", qImp: "Jaka pora roku jest najbrzydsza" },
            { haslo: "Ulubiony sk≈Çadnik pizzy?", qImp: "Jaki sk≈Çadnik musi siƒô znale≈∫ƒá w Twoim ulubionym fast-foodzie?" },
            { haslo: "Co lubisz robiƒá, gdy na dworze pada deszcz?", qImp: "Jaki jest Tw√≥j ulubiony spos√≥b na nudƒô w domu?" },
            { haslo: "Z jakiego portalu spo≈Çeczno≈õciowego korzystasz najwiƒôcej?", qImp: "Gdzie najczƒô≈õciej szukasz ciekawych filmik√≥w lub zdjƒôƒá?" },
            { haslo: "Gdyby≈õ m√≥g≈Ç mieƒá egzotyczne zwierzƒô, co by to by≈Ço?", qImp: "Jakie egzotyczne zwierzƒô najbardziej Ciƒô fascynuje?" },
            { haslo: "Czego najbardziej nie lubisz robiƒá w domu?", qImp: "Jaki obowiƒÖzek domowy zawsze odk≈Çadasz na p√≥≈∫niej?" },
            { haslo: "Kim chcia≈Çe≈õ zostaƒá, jak by≈Çe≈õ ma≈Çy?", qImp: "W jakiej pracy m√≥g≈Çby≈õ siƒô odnale≈∫ƒá?" },
            { haslo: "Co jest Twoim najwiƒôkszym talentem?", qImp: "W czym czujesz siƒô lepszy od wiƒôkszo≈õci ludzi?" },
            { haslo: "Jaki temat jest Twoim ulubiony?", qImp: "O czym m√≥g≈Çby≈õ rozmawiaƒá godzinami bez przygotowania?" },
            { haslo: "Z czego najczƒô≈õciej siƒô ≈õmiejesz?", qImp: "Jaki typ ≈ºart√≥w najbardziej do Ciebie trafia?" },
            { haslo: "Co najbardziej irytuje Ciƒô u innych ludzi?", qImp: "Jakie zachowanie sprawia, ≈ºe tracisz do kogo≈õ cierpliwo≈õƒá?" },
            { haslo: "O kt√≥rej godzinie zazwyczaj jesz obiad?", qImp: "O kt√≥rej godzinie czujesz najwiƒôkszy g≈Ç√≥d w ciƒÖgu dnia?" },
            { haslo: "Ulubione ≈õwiƒôto w roku?", qImp: "Na jakim ≈õwiƒôcie najbardziej lubisz siƒô spotykaƒá z rodzinƒÖ?" },
            { haslo: "Jaki jest Tw√≥j ulubiony spos√≥b na spƒôdzanie czasu z ekipƒÖ?", qImp: "Co zazwyczaj robicie, gdy spotykacie siƒô wieczorem?" },
            { haslo: "W jakiej restauracji w okolicy jedzenie jest najlepsze?", qImp: "Gdzie najchƒôtniej idziesz, gdy nie chce Ci siƒô gotowaƒá?" },
            { haslo: "Jaki alkohol najczƒô≈õciej pojawia siƒô na imprezach?", qImp: "Co najlepiej pasuje do picia podczas wsp√≥lnego grania?" },
            { haslo: "Jaka gra planszowa/karciana jest WaszƒÖ ulubionƒÖ?", qImp: "Przy jakiej grze zawsze jest u Was najwiƒôcej k≈Ç√≥tni?" },
            { haslo: "Kto z nas jest najbardziej punktualny?", qImp: "Kto z nas zawsze przejmuje inicjatywƒô przy planowaniu wyj≈õƒá?" },
            { haslo: "Jaki utw√≥r muzyczny kojarzy Ci siƒô z wakacjami?", qImp: "Przy jakiej piosence zawsze masz ochotƒô podg≈Ço≈õniƒá radio?" },
            { haslo: "Gdzie najczƒô≈õciej robisz zakupy spo≈ºywcze?", qImp: "Do jakiego sklepu masz najbli≈ºej z domu?" },
            { haslo: "JakƒÖ supermoc chcia≈Çby≈õ posiadaƒá?", qImp: "Jaka supermoc u≈Çatwi≈Çaby Ci codzienne ≈ºycie?" },
            { haslo: "Co najbardziej lubisz robiƒá w internecie?", qImp: "Na co marnujesz najwiƒôcej czasu przed ekranem?" }
        ];

        // ==========================================
        // üß¨ DANE: THE TEST
        // ==========================================
        const TEST_QUESTIONS = [
            { q: "Ulubiony spos√≥b na relaks?", o: ["Sen", "Serial", "Sport"], type: "select" },
            { q: "Jaki jest m√≥j ulubiony spos√≥b na spƒôdzanie wolnego czasu?", o: ["OglƒÖdanie seriali/film√≥w", "Wyj≈õcie ze znajomymi", "Sport lub hobby"], type: "select" },
            { q: "Gdybym m√≥g≈Ç/mog≈Ça zje≈õƒá tylko jednƒÖ rzecz do ko≈Ñca ≈ºycia, co by to by≈Ço?", o: ["Pizza", "Kebab", "Domowy obiad"], type: "select" },
            { q: "Czego najbardziej nie lubiƒô robiƒá w domu?", o: ["Zmywaƒá naczy≈Ñ", "SprzƒÖtaƒá", "Wynosiƒá ≈õmieci"], type: "select" },
            { q: "Jaki jest m√≥j wymarzony kierunek podr√≥≈ºy?", o: ["Egzotyczna pla≈ºa", "Europejska stolica", "G√≥ry lub dzika natura"], type: "select" },
            { q: "Jaki by≈Ç/jest m√≥j ulubiony przedmiot w szkole?", o: ["Jƒôzyki obce / polski", "Matematyka / ≈õcis≈Çe", "WF"], type: "select" },
            { q: "Co mnie najbardziej irytuje u innych ludzi?", o: ["Sp√≥≈∫nialstwo", "K≈Çamanie", "G≈Ço≈õne zachowanie"], type: "select" },
            { q: "W jakiej sytuacji najczƒô≈õciej tracƒô cierpliwo≈õƒá?", o: ["Gdy co≈õ mi nie wychodzi", "Gdy kto≈õ robi co≈õ czego nie chce", "Gdy jestem g≈Çodny/a lub niewyspany/a"], type: "select" },
            { q: "Kim chcia≈Çem/am zostaƒá, jak by≈Çem/am ma≈Çy/a?", o: ["Piosenkarzem/kƒÖ lub Aktorem/kƒÖ", "Lekarzem/kƒÖ lub Weterynarzem", "Nauczycielem/kƒÖ"], type: "select" },
            { q: "Jaki jest m√≥j styl ubierania siƒô na co dzie≈Ñ?", o: ["Typowy dresiarz / oversize", "Elegancko i dopasowanie", "Casual (d≈ºinsy i t-shirt)"], type: "select" },
            { q: "Kt√≥ra cecha Twojego charakteru najbardziej mnie czasem denerwuje?", o: ["Uparto≈õƒá", "Toksyczno≈õƒá", "G≈Çupota"], type: "select" },
            { q: "Jaka jest twoja ulubiona piosenka?", type: "input" },
            { q: "Ulubiony wykonawca muzyczny?", type: "input" },
            { q: "Najlepszy gatunek muzyczny?", o: ["Rap", "Disco Polo", "Hip-hop"], type: "select" },
            { q: "Ulubiona pora dnia drugiej osoby?", type: "input" },
            { q: "Czego druga osoba s≈Çucha najczƒô≈õciej?", type:"input" },
            { q: "Ulubiony nap√≥j procentowy?",type:"input" },
            { q: "?", o: ["", "", ""] },
            { q: "?", o: ["", "", ""] },
            { q: "?", o: ["", "", ""] },
            { q: "?", o: ["", "", ""] },
            { q: "?", o: ["", "", ""] },
            { q: "?", o: ["", "", ""] },
            { q: "Kto pierwszy wyciƒÖga rƒôkƒô po k≈Ç√≥tni?", o: ["Ja", "Ty", "Zale≈ºy"] }
        ];

        // ==========================================
        // ‚öôÔ∏è LOGIKA GRY
        // ==========================================
        const firebaseConfig = { apiKey: "AIzaSyAQLLZui2v4j3nLLKXhp2brcqsgSyy0W2s", databaseURL: "https://menu-gier-default-rtdb.europe-west1.firebasedatabase.app" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myNick = "", activeRoom = "", currentImpMode = "words", hintsEnabled = false, activeTestRelId = "";

        function nav(id) { document.querySelectorAll('.container > div').forEach(d => d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }

        // IMPOSTOR LOGIC
        function setImpMode(m) {
            currentImpMode = m;
            document.getElementById('btn-m-w').classList.toggle('active', m === 'words');
            document.getElementById('btn-m-q').classList.toggle('active', m === 'questions');
            document.getElementById('hint-option-box').style.display = m === 'words' ? 'flex' : 'none';
        }
        function toggleHints() { hintsEnabled = !hintsEnabled; document.getElementById('hint-status').innerText = hintsEnabled ? "ON" : "OFF"; document.getElementById('hint-status').style.color = hintsEnabled ? "var(--success)" : "var(--danger)"; }

        function startImpostor(isHost) {
            myNick = document.getElementById('imp-nick').value.trim(); activeRoom = document.getElementById('imp-room').value.trim();
            if (!myNick || !activeRoom) return alert("Wpisz nick i kod!");
            const ref = db.ref('impostor_v8/' + activeRoom);
            if (isHost) {
                const secret = currentImpMode === 'words' ? WORDS_DATABASE[Math.floor(Math.random() * WORDS_DATABASE.length)] : QUES_DATABASE[Math.floor(Math.random() * QUES_DATABASE.length)];
                ref.set({ host: myNick, mode: currentImpMode, state: 'waiting', secret, hintsOn: hintsEnabled });
            }
            ref.child('players/' + myNick).set(true); listenImpostor(); nav('screen-impostor-game');
        }

        function listenImpostor() {
            db.ref('impostor_v8/' + activeRoom).on('value', snap => {
                const d = snap.val(); if (!d) return;
                document.getElementById('imp-display-room').innerText = "Pok√≥j: " + activeRoom;
                document.getElementById('imp-players').innerHTML = Object.keys(d.players || {}).map(p => `<div style="padding:5px">${p}</div>`).join('');
                if (d.host === myNick && d.state === 'waiting') document.getElementById('imp-start-btn').style.display = 'block';
                if (d.state === 'revealed') {
                    document.getElementById('imp-waiting').classList.add('hidden'); document.getElementById('imp-role-card').classList.remove('hidden');
                    const isImp = d.impostors.includes(myNick);
                    document.getElementById('role-title').innerText = isImp ? "IMPOSTOR" : "GRACZ";
                    document.getElementById('role-title').style.color = isImp ? "var(--danger)" : "var(--success)";

                    let val = "";
                    if (isImp) {
                        if (d.mode === 'words') val = d.hintsOn ? "Podpowied≈∫: " + d.secret.podpowiedzi[0] : "???";
                        else val = d.secret.qImp; // Pytanie alternatywne dla Impostora
                    } else {
                        val = d.secret.haslo;
                    }
                    document.getElementById('role-value').innerText = val;
                    document.getElementById('role-desc').innerText = isImp ? "Twoje zadanie to wtopiƒá siƒô w t≈Çum. Odpowiadaj sprytnie!" : "Wszyscy gracze widzƒÖ to samo. Znajd≈∫ zdrajcƒô!";
                }
            });
        }

        function revealRoles() {
            const ref = db.ref('impostor_v8/' + activeRoom);
            ref.once('value', s => {
                const data = s.val(); const players = Object.keys(data.players);
                const imps = players.sort(() => 0.5 - Math.random()).slice(0, Math.max(1, Math.floor(players.length / 4)));
                let secret = JSON.parse(JSON.stringify(data.secret));
                if (secret.haslo.includes("{gracz}")) {
                    const randomP = players[Math.floor(Math.random() * players.length)];
                    secret.haslo = secret.haslo.replace(/{gracz}/g, randomP);
                    if (secret.qImp) secret.qImp = secret.qImp.replace(/{gracz}/g, randomP);
                }
                ref.update({ state: 'revealed', impostors: imps, secret });
            });
        }
        function leaveImpostor() { db.ref('impostor_v8/' + activeRoom).off(); nav('screen-launcher'); }

        // THE TEST LOGIC
        function handleTestAutoLogin() { const s = localStorage.getItem('kamil_test_nick'); if (s) { myNick = s; enterTestDash(); } else nav('screen-test-auth'); }
        function testLogin() {
            myNick = document.getElementById('test-nick').value.trim(); const pin = document.getElementById('test-pin').value.trim();
            if (!myNick || pin.length < 4) return alert("Nick i PIN!");
            db.ref('test_v6/users/' + myNick).once('value', s => {
                if (s.exists() && s.val().pin !== pin) return alert("B≈Çƒôdny PIN!");
                if (!s.exists()) db.ref('test_v6/users/' + myNick).set({ nick: myNick, pin });
                localStorage.setItem('kamil_test_nick', myNick); enterTestDash();
            });
        }
        function enterTestDash() {
            nav('screen-test-dash'); document.getElementById('test-user-name').innerText = "Cze≈õƒá, " + myNick;
            db.ref('test_v6/rels').on('value', s => {
                const list = document.getElementById('test-list'); list.innerHTML = "";
                const data = s.val() || {};
                Object.keys(data).forEach(id => {
                    if (id.includes(myNick)) {
                        const partner = id.replace(myNick, "").replace("_", "");
                        const d = document.createElement('div'); d.className = "main-btn";
                        d.innerHTML = `<strong>${partner}</strong> ${data[id].turn === myNick ? '<span style="float:right;color:var(--success)">TW√ìJ RUCH</span>' : ''}`;
                        d.onclick = () => openTestGame(id, partner); list.appendChild(d);
                    }
                });
            });
        }
        function newTestRel() {
            const t = document.getElementById('test-target').value.trim(); if (!t || t === myNick) return;
            const id = [myNick, t].sort().join("_");
            db.ref('test_v6/rels/' + id).set({ level: 1, xp: 0, turn: myNick, step: 'ASKING', idx: 0, pack: [0, 1].map(() => Math.floor(Math.random() * TEST_QUESTIONS.length)), ans: [], gus: [] });
        }
        

        // Sprawdzenie: czy pytanie jest otwarte (input) czy zamkniƒôte (select)
        if (qObj.type === "input") {
            qArea.innerHTML = `
        <input type="text" id="test-custom-ans" placeholder="Wpisz odpowied≈∫...">
        <button class="action-btn" onclick="const v = document.getElementById('test-custom-ans').value; if(v) handleTestMove('${id}', ${JSON.stringify(d).replace(/"/g, '&quot;')}, v, '${partner}')">WY≈öLIJ</button>
    `;
        } else {
            qObj.o.forEach(o => {
                const b = document.createElement('button');
                b.className = "action-btn";
                b.innerText = o;
                b.onclick = () => handleTestMove(id, d, o, partner);
                qArea.appendChild(b);
            });
        }
        function handleTestMove(id, data, val, partner) {
            const ref = db.ref('test_v6/rels/' + id);
            if (data.step === 'ASKING') {
                let a = data.ans || []; a.push(val);
                if (a.length >= data.pack.length) ref.update({ ans: a, step: 'GUESSING', idx: 0, turn: partner });
                else ref.update({ ans: a, idx: data.idx + 1 });
            } else {
                let g = data.gus || []; g.push(val);
                if (g.length >= data.pack.length) ref.update({ gus: g, step: 'REVEAL' });
                else ref.update({ gus: g, idx: data.idx + 1 });
            }
        }
        d.pack.forEach((qi, i) => {
            // Sprawdzanie dopasowania ignorujƒÖc wielko≈õƒá liter i spacje (wa≈ºne przy wpisywaniu rƒôcznym)
            const valAns = String(d.ans[i] || "").trim().toLowerCase();
            const valGus = String(d.gus[i] || "").trim().toLowerCase();
            const isMatch = valAns === valGus;

            list.innerHTML += `
        <div class="reveal-item" style="border-left-color:${isMatch ? 'var(--success)' : 'var(--danger)'}">
            <small>${TEST_QUESTIONS[qi].q}</small><br>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                <span>
                    <b style="color:var(--accent)">Odp:</b> ${d.ans[i]}<br>
                    <b style="color:var(--xp)">Strza≈Ç:</b> ${d.gus[i]}
                </span>
                <span style="font-size:1.2rem">${isMatch ? '‚úÖ' : '‚ùå'}</span>
            </div>
        </div>`;
        });
        function testConfirmReveal() {
            const ref = db.ref('test_v6/rels/' + activeTestRelId);
            ref.once('value', s => {
                const d = s.val(); let matches = 0;
                let hist = d.pack.map((qi, i) => { const m = d.ans[i] === d.gus[i]; if (m) matches++; return { q: TEST_QUESTIONS[qi].q, a: d.ans[i], m }; });
                let xp = d.xp + (matches * 100) + 20; let lvl = d.level; if (xp >= lvl * 300) { xp = 0; lvl++; }
                ref.update({ level: lvl, xp, last: hist, ans: [], gus: [], idx: 0, step: 'ASKING', turn: myNick, pack: [0, 1].map(() => Math.floor(Math.random() * TEST_QUESTIONS.length)) });
                nav('screen-test-dash');
            });
        }
        function testLogout() { localStorage.clear(); nav('screen-launcher'); }
    </script>
</body>
</html>
